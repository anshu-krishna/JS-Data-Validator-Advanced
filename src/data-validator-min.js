function isObject(t){return null!==t&&"object"==typeof t}export class Ret{value;valid;error;constructor(t,e){t=!!t,this.valid=t,this.value=t?e:null,this.error=t?null:e}static Valid(t=null){return new Ret(!0,t)}static Invalid(t=null){return new Ret(!1,t)}}export const Parser=function(){"use strict";function t(e,n,r,i){this.message=e,this.expected=n,this.found=r,this.location=i,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}return function(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}(t,Error),t.buildMessage=function(t,e){let n={literal:function(t){return'"'+i(t.text)+'"'},class:function(t){let e,n="";for(e=0;e<t.parts.length;e++)n+=t.parts[e]instanceof Array?u(t.parts[e][0])+"-"+u(t.parts[e][1]):u(t.parts[e]);return"["+(t.inverted?"^":"")+n+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function r(t){return t.charCodeAt(0).toString(16).toUpperCase()}function i(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+r(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+r(t)}))}function u(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+r(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+r(t)}))}return"Expected "+function(t){let e,r,i=new Array(t.length);for(e=0;e<t.length;e++)i[e]=(u=t[e],n[u.type](u));var u;if(i.sort(),i.length>0){for(e=1,r=1;e<i.length;e++)i[e-1]!==i[e]&&(i[r]=i[e],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+i(t)+'"':"end of input"}(e)+" found."},{SyntaxError:t,parse:function(e,n){n=void 0!==n?n:{};let r,i={},u={Format:Xt},a=Xt,s="=>",o=qt("=>",!1),l=function(t,e){return e},c=qt("|",!1),f=function(t,e){return e},p=function(t,e){return Object.fromEntries([t,...e])},d="...",h=qt("...",!1),y=Ht("identifier:data-type pair"),g=qt("?",!1),m=qt("=",!1),v=Ht("repeat-count"),b="..",w=qt("..",!1),$=Ht("function-list"),x=function(t,e){return[t,...e]},A=Ht("function"),R=".",E=qt(".",!1),O="null",C=qt("null",!1),N=(Ht("bool"),"false"),S=qt("false",!1),T="true",j=qt("true",!1),I=Ht("object"),k=function(t,e){return e},F=Ht("key:val pair"),_=function(t,e){return[t,e]},J=Ht("key"),V=function(){return Pt()},D=Ht("identifier"),z=/^[_a-z$]/i,L=Bt(["_",["a","z"],"$"],!1,!0),M=/^[0-9a-z$_]/i,U=Bt([["0","9"],["a","z"],"$","_"],!1,!0),P=Ht("value-list"),q=Ht("number"),B="-",H=qt("-",!1),G=/^[eE]/,K=Bt(["e","E"],!1,!1),Q=qt("+",!1),W=qt("0",!1),X=/^[1-9]/,Y=Bt([["1","9"]],!1,!1),Z=/^[0-9]/,tt=Bt([["0","9"]],!1,!1),et=Ht("string"),nt=qt('"',!1),rt=function(t){return t.join("")},it=qt("'",!1),ut=qt("`",!1),at=/^[^\0-\x1F\\"]/,st=Bt([["\0",""],"\\",'"'],!0,!1),ot=/^[^\0-\x1F\\']/,lt=Bt([["\0",""],"\\","'"],!0,!1),ct=/^[^\0-\x1F\\`]/,ft=Bt([["\0",""],"\\","`"],!0,!1),pt=Ht("Escaped-Char"),dt=qt("\\\\",!1),ht=qt('\\"',!1),yt=qt("\\'",!1),gt=qt("\\`",!1),mt=qt("\\b",!1),vt=qt("\\f",!1),bt=qt("\\n",!1),wt=qt("\\r",!1),$t=qt("\\t",!1),xt=qt("\\u",!1),At=qt("[",!1),Rt=qt("]",!1),Et=qt("(",!1),Ot=qt(")",!1),Ct=qt("{",!1),Nt=qt("}",!1),St=qt(":",!1),Tt=qt(",",!1),jt=Ht("whitespace"),It=/^[ \t\n\r]/,kt=Bt([" ","\t","\n","\r"],!1,!1),Ft=Ht("hex-char"),_t=/^[0-9a-f]/i,Jt=Bt([["0","9"],["a","f"]],!1,!0),Vt=0,Dt=0,zt=[{line:1,column:1}],Lt=0,Mt=[],Ut=0;if("startRule"in n){if(!(n.startRule in u))throw new Error("Can't start parsing from rule \""+n.startRule+'".');a=u[n.startRule]}function Pt(){return e.substring(Dt,Vt)}function qt(t,e){return{type:"literal",text:t,ignoreCase:e}}function Bt(t,e,n){return{type:"class",parts:t,inverted:e,ignoreCase:n}}function Ht(t){return{type:"other",description:t}}function Gt(t){let n,r=zt[t];if(r)return r;for(n=t-1;!zt[n];)n--;for(r=zt[n],r={line:r.line,column:r.column};n<t;)10===e.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return zt[t]=r,r}function Kt(t,e){let n=Gt(t),r=Gt(e);return{start:{offset:t,line:n.line,column:n.column},end:{offset:e,line:r.line,column:r.column}}}function Qt(t){Vt<Lt||(Vt>Lt&&(Lt=Vt,Mt=[]),Mt.push(t))}function Wt(e,n,r){return new t(t.buildMessage(e,n),e,n,r)}function Xt(){let t,n,r,u,a,c,f,p,d;if(t=Vt,n=Re(),n!==i)if(r=Yt(),r!==i){for(u=[],a=Vt,c=Re(),c!==i?(e.substr(Vt,2)===s?(f=s,Vt+=2):(f=i,0===Ut&&Qt(o)),f!==i?(p=Re(),p!==i?(d=Yt(),d!==i?(Dt=a,c=l(0,d),a=c):(Vt=a,a=i)):(Vt=a,a=i)):(Vt=a,a=i)):(Vt=a,a=i);a!==i;)u.push(a),a=Vt,c=Re(),c!==i?(e.substr(Vt,2)===s?(f=s,Vt+=2):(f=i,0===Ut&&Qt(o)),f!==i?(p=Re(),p!==i?(d=Yt(),d!==i?(Dt=a,c=l(0,d),a=c):(Vt=a,a=i)):(Vt=a,a=i)):(Vt=a,a=i)):(Vt=a,a=i);u!==i?(Dt=t,n=function(t,e){let n=[t,...e];for(;n.length>1;){const t=n.pop();n[n.length-1].nx=t}return n[0]}(r,u),t=n):(Vt=t,t=i)}else Vt=t,t=i;else Vt=t,t=i;return t===i&&(t=Vt,n=Re(),n!==i?(r=Yt(),r!==i?(n=[n,r],t=n):(Vt=t,t=i)):(Vt=t,t=i)),t}function Yt(){let t,n,r,u,a,s,o,l,y;if(t=Vt,n=ve(),n!==i)if(r=Xt(),r!==i){for(u=[],a=Vt,s=Re(),s!==i?(124===e.charCodeAt(Vt)?(o="|",Vt++):(o=i,0===Ut&&Qt(c)),o!==i?(l=Re(),l!==i?(y=Xt(),y!==i?(Dt=a,s=f(0,y),a=s):(Vt=a,a=i)):(Vt=a,a=i)):(Vt=a,a=i)):(Vt=a,a=i);a!==i;)u.push(a),a=Vt,s=Re(),s!==i?(124===e.charCodeAt(Vt)?(o="|",Vt++):(o=i,0===Ut&&Qt(c)),o!==i?(l=Re(),l!==i?(y=Xt(),y!==i?(Dt=a,s=f(0,y),a=s):(Vt=a,a=i)):(Vt=a,a=i)):(Vt=a,a=i)):(Vt=a,a=i);u!==i?(a=be(),a!==i?(s=ee(),s===i&&(s=null),s!==i?(Dt=t,n=function(t,e,n){const r=[t,...e];if(1===r.length){let t=[...r[0]?.fn??[],...n??[]];return 0===t.length&&(t=null),Oe({...r[0],fn:t})}return Oe({ty:"@or@",ls:r,fn:n})}(r,u,s),t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i)}else Vt=t,t=i;else Vt=t,t=i;if(t===i){if(t=Vt,n=ge(),n!==i){if(r=Vt,u=te(),u!==i){for(a=[],s=Vt,o=Ae(),o!==i?(l=te(),l!==i?(Dt=s,o=f(0,l),s=o):(Vt=s,s=i)):(Vt=s,s=i);s!==i;)a.push(s),s=Vt,o=Ae(),o!==i?(l=te(),l!==i?(Dt=s,o=f(0,l),s=o):(Vt=s,s=i)):(Vt=s,s=i);a!==i?(s=Ae(),s===i&&(s=null),s!==i?(Dt=r,g=a,u=[u,...g],r=u):(Vt=r,r=i)):(Vt=r,r=i)}else Vt=r,r=i;r===i&&(r=null),r!==i?(u=me(),u!==i?(a=ee(),a===i&&(a=null),a!==i?(Dt=t,n=Oe({ty:"@arr@",ls:r??[],fn:a}),t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i)}else Vt=t,t=i;if(t===i){if(t=Vt,n=we(),n!==i){if(r=Vt,u=Zt(),u!==i){for(a=[],s=Vt,o=Ae(),o!==i?(l=Zt(),l!==i?(Dt=s,o=f(0,l),s=o):(Vt=s,s=i)):(Vt=s,s=i);s!==i;)a.push(s),s=Vt,o=Ae(),o!==i?(l=Zt(),l!==i?(Dt=s,o=f(0,l),s=o):(Vt=s,s=i)):(Vt=s,s=i);a!==i?(Dt=r,u=p(u,a),r=u):(Vt=r,r=i)}else Vt=r,r=i;r===i&&(r=null),r!==i?(u=Vt,a=Ae(),a!==i?(e.substr(Vt,3)===d?(s=d,Vt+=3):(s=i,0===Ut&&Qt(h)),s!==i?(a=[a,s],u=a):(Vt=u,u=i)):(Vt=u,u=i),u===i&&(u=null),u!==i?(a=Ae(),a===i&&(a=null),a!==i?(s=$e(),s!==i?(o=ee(),o===i&&(o=null),o!==i?(Dt=t,n=function(t,e,n){const r=Oe({ty:"@obj@",ls:t,fn:n});return e&&(r.kp=!0),r}(r,u,o),t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i)}else Vt=t,t=i;t===i&&(t=Vt,n=se(),n!==i?(r=ee(),r===i&&(r=null),r!==i?(Dt=t,n=function(t,e){return Oe({ty:t,fn:e})}(n,r),t=n):(Vt=t,t=i)):(Vt=t,t=i))}}var g;return t}function Zt(){let t,n,r,u,a,s,o,l,c,f;var p,d,h;return Ut++,t=Vt,63===e.charCodeAt(Vt)?(n="?",Vt++):(n=i,0===Ut&&Qt(g)),n===i&&(n=null),n!==i?(r=se(),r!==i?(u=Vt,a=ve(),a!==i?(s=Re(),s!==i?(61===e.charCodeAt(Vt)?(o="=",Vt++):(o=i,0===Ut&&Qt(m)),o!==i?(l=Re(),l!==i?(c=re(),c!==i?(f=be(),f!==i?(Dt=u,a={val:c},u=a):(Vt=u,u=i)):(Vt=u,u=i)):(Vt=u,u=i)):(Vt=u,u=i)):(Vt=u,u=i)):(Vt=u,u=i),u===i&&(u=null),u!==i?(a=xe(),a!==i?(s=Xt(),s!==i?(Dt=t,p=r,d=u,h=s,null===n&&(h.rq=!0),null!==d&&(h.def=d.val),n=[p,h],t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i),Ut--,t===i&&(n=i,0===Ut&&Qt(y)),t}function te(){let t,n,r;var u,a;return t=Vt,n=function(){let t,n,r,u,a;Ut++,t=Vt,e.substr(Vt,2)===b?(n=b,Vt+=2):(n=i,0===Ut&&Qt(w));n!==i?(r=le(),r!==i?(e.substr(Vt,2)===b?(u=b,Vt+=2):(u=i,0===Ut&&Qt(w)),u!==i?(a=Re(),a!==i?(Dt=t,n=parseFloat(r),t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i);t===i&&(t=Vt,e.substr(Vt,3)===d?(n=d,Vt+=3):(n=i,0===Ut&&Qt(h)),n!==i?(r=Re(),r!==i?(Dt=t,n="yes",t=n):(Vt=t,t=i)):(Vt=t,t=i));Ut--,t===i&&(n=i,0===Ut&&Qt(v));return t}(),n===i&&(n=null),n!==i?(r=Xt(),r!==i?(Dt=t,a=r,(u=n)&&(a.rpt=u),n=a,t=n):(Vt=t,t=i)):(Vt=t,t=i),t}function ee(){let t,e,n,r;if(Ut++,t=Vt,e=ne(),e!==i){for(n=[],r=ne();r!==i;)n.push(r),r=ne();n!==i?(Dt=t,e=x(e,n),t=e):(Vt=t,t=i)}else Vt=t,t=i;return Ut--,t===i&&(e=i,0===Ut&&Qt($)),t}function ne(){let t,n,r,u,a,s,o,l;return Ut++,t=Vt,n=Re(),n!==i?(46===e.charCodeAt(Vt)?(r=R,Vt++):(r=i,0===Ut&&Qt(E)),r!==i?(u=se(),u!==i?(a=Vt,s=ve(),s!==i?(o=oe(),o===i&&(o=null),o!==i?(l=be(),l!==i?(Dt=a,s=o,a=s):(Vt=a,a=i)):(Vt=a,a=i)):(Vt=a,a=i),a===i&&(a=null),a!==i?(Dt=t,n=function(t,e){const n={fn:t};return e&&(n.args=e),n}(u,a),t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i),Ut--,t===i&&(n=i,0===Ut&&Qt(A)),t}function re(){let t;return t=ie(),t===i&&(t=function(){let t,n;t=Vt,e.substr(Vt,4)===O?(n=O,Vt+=4):(n=i,0===Ut&&Qt(C));n!==i&&(Dt=t,n=null);return t=n,t}(),t===i&&(t=ue(),t===i&&(t=function(){let t,e,n,r,u,a,s,o;if(Ut++,t=Vt,e=we(),e!==i){if(n=Vt,r=ae(),r!==i){for(u=[],a=Vt,s=Ae(),s!==i?(o=ae(),o!==i?(Dt=a,s=k(0,o),a=s):(Vt=a,a=i)):(Vt=a,a=i);a!==i;)u.push(a),a=Vt,s=Ae(),s!==i?(o=ae(),o!==i?(Dt=a,s=k(0,o),a=s):(Vt=a,a=i)):(Vt=a,a=i);u!==i?(Dt=n,r=p(r,u),n=r):(Vt=n,n=i)}else Vt=n,n=i;n===i&&(n=null),n!==i?(r=Ae(),r===i&&(r=null),r!==i?(u=$e(),u!==i?(Dt=t,e=null!==(l=n)?l:{},t=e):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i)}else Vt=t,t=i;var l;Ut--,t===i&&(e=i,0===Ut&&Qt(I));return t}(),t===i&&(t=function(){let t,e,n,r,u;t=Vt,e=ge(),e!==i?(n=oe(),n===i&&(n=null),n!==i?(r=Ae(),r===i&&(r=null),r!==i?(u=me(),u!==i?(Dt=t,e=n??[],t=e):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i);return t}(),t===i&&(t=function(){let t,n,r,u,a,s,o;Ut++,t=Vt,45===e.charCodeAt(Vt)?(n="-",Vt++):(n=i,0===Ut&&Qt(H));n===i&&(n=null);if(n!==i)if(r=le(),r!==i){if(u=Vt,46===e.charCodeAt(Vt)?(a=R,Vt++):(a=i,0===Ut&&Qt(E)),a!==i){if(s=[],o=ce(),o!==i)for(;o!==i;)s.push(o),o=ce();else s=i;s!==i?(a=[a,s],u=a):(Vt=u,u=i)}else Vt=u,u=i;u===i&&(u=null),u!==i?(a=function(){let t,n,r,u,a;t=Vt,G.test(e.charAt(Vt))?(n=e.charAt(Vt),Vt++):(n=i,0===Ut&&Qt(K));if(n!==i)if(45===e.charCodeAt(Vt)?(r=B,Vt++):(r=i,0===Ut&&Qt(H)),r===i&&(43===e.charCodeAt(Vt)?(r="+",Vt++):(r=i,0===Ut&&Qt(Q))),r===i&&(r=null),r!==i){if(u=[],a=ce(),a!==i)for(;a!==i;)u.push(a),a=ce();else u=i;u!==i?(Dt=t,n=V(),t=n):(Vt=t,t=i)}else Vt=t,t=i;else Vt=t,t=i;return t}(),a===i&&(a=null),a!==i?(Dt=t,n=parseFloat(Pt()),t=n):(Vt=t,t=i)):(Vt=t,t=i)}else Vt=t,t=i;else Vt=t,t=i;Ut--,t===i&&(n=i,0===Ut&&Qt(q));return t}(),t===i&&(t=fe())))))),t}function ie(){let t,n;return t=Vt,e.substr(Vt,5)===N?(n=N,Vt+=5):(n=i,0===Ut&&Qt(S)),n!==i&&(Dt=t,n=!1),t=n,t}function ue(){let t,n;return t=Vt,e.substr(Vt,4)===T?(n=T,Vt+=4):(n=i,0===Ut&&Qt(j)),n!==i&&(Dt=t,n=!0),t=n,t}function ae(){let t,n,r,u;return Ut++,t=Vt,n=fe(),n!==i?(r=xe(),r!==i?(u=re(),u!==i?(Dt=t,n=_(n,u),t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i),t===i&&(t=Vt,n=function(){let t,n,r,u,a,s;if(Ut++,t=Vt,n=se(),n!==i){for(r=[],u=Vt,46===e.charCodeAt(Vt)?(a=R,Vt++):(a=i,0===Ut&&Qt(E)),a!==i?(s=se(),s!==i?(a=[a,s],u=a):(Vt=u,u=i)):(Vt=u,u=i);u!==i;)r.push(u),u=Vt,46===e.charCodeAt(Vt)?(a=R,Vt++):(a=i,0===Ut&&Qt(E)),a!==i?(s=se(),s!==i?(a=[a,s],u=a):(Vt=u,u=i)):(Vt=u,u=i);r!==i?(Dt=t,n=V(),t=n):(Vt=t,t=i)}else Vt=t,t=i;Ut--,t===i&&(n=i,0===Ut&&Qt(J));return t}(),n!==i?(r=xe(),r!==i?(u=re(),u!==i?(Dt=t,n=_(n,u),t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i)),Ut--,t===i&&(n=i,0===Ut&&Qt(F)),t}function se(){let t,n,r,u,a;if(Ut++,t=Vt,n=Vt,z.test(e.charAt(Vt))?(r=e.charAt(Vt),Vt++):(r=i,0===Ut&&Qt(L)),r!==i){for(u=[],M.test(e.charAt(Vt))?(a=e.charAt(Vt),Vt++):(a=i,0===Ut&&Qt(U));a!==i;)u.push(a),M.test(e.charAt(Vt))?(a=e.charAt(Vt),Vt++):(a=i,0===Ut&&Qt(U));u!==i?(r=[r,u],n=r):(Vt=n,n=i)}else Vt=n,n=i;return n!==i&&(Dt=t,n=V()),t=n,Ut--,t===i&&(n=i,0===Ut&&Qt(D)),t}function oe(){let t,e,n,r,u,a;if(Ut++,t=Vt,e=re(),e!==i){for(n=[],r=Vt,u=Ae(),u!==i?(a=re(),a!==i?(Dt=r,u=f(0,a),r=u):(Vt=r,r=i)):(Vt=r,r=i);r!==i;)n.push(r),r=Vt,u=Ae(),u!==i?(a=re(),a!==i?(Dt=r,u=f(0,a),r=u):(Vt=r,r=i)):(Vt=r,r=i);n!==i?(Dt=t,e=x(e,n),t=e):(Vt=t,t=i)}else Vt=t,t=i;return Ut--,t===i&&(e=i,0===Ut&&Qt(P)),t}function le(){let t,n,r,u,a;if(t=Vt,48===e.charCodeAt(Vt)?(n="0",Vt++):(n=i,0===Ut&&Qt(W)),n===i)if(n=Vt,X.test(e.charAt(Vt))?(r=e.charAt(Vt),Vt++):(r=i,0===Ut&&Qt(Y)),r!==i){for(u=[],a=ce();a!==i;)u.push(a),a=ce();u!==i?(r=[r,u],n=r):(Vt=n,n=i)}else Vt=n,n=i;return n!==i&&(Dt=t,n=V()),t=n,t}function ce(){let t;return Z.test(e.charAt(Vt))?(t=e.charAt(Vt),Vt++):(t=i,0===Ut&&Qt(tt)),t}function fe(){let t,n,r,u;if(Ut++,t=Vt,34===e.charCodeAt(Vt)?(n='"',Vt++):(n=i,0===Ut&&Qt(nt)),n!==i){for(r=[],u=pe();u!==i;)r.push(u),u=pe();r!==i?(34===e.charCodeAt(Vt)?(u='"',Vt++):(u=i,0===Ut&&Qt(nt)),u!==i?(Dt=t,n=rt(r),t=n):(Vt=t,t=i)):(Vt=t,t=i)}else Vt=t,t=i;if(t===i){if(t=Vt,39===e.charCodeAt(Vt)?(n="'",Vt++):(n=i,0===Ut&&Qt(it)),n!==i){for(r=[],u=de();u!==i;)r.push(u),u=de();r!==i?(39===e.charCodeAt(Vt)?(u="'",Vt++):(u=i,0===Ut&&Qt(it)),u!==i?(Dt=t,n=rt(r),t=n):(Vt=t,t=i)):(Vt=t,t=i)}else Vt=t,t=i;if(t===i)if(t=Vt,96===e.charCodeAt(Vt)?(n="`",Vt++):(n=i,0===Ut&&Qt(ut)),n!==i){for(r=[],u=he();u!==i;)r.push(u),u=he();r!==i?(96===e.charCodeAt(Vt)?(u="`",Vt++):(u=i,0===Ut&&Qt(ut)),u!==i?(Dt=t,n=rt(r),t=n):(Vt=t,t=i)):(Vt=t,t=i)}else Vt=t,t=i}return Ut--,t===i&&(n=i,0===Ut&&Qt(et)),t}function pe(){let t,n;return at.test(e.charAt(Vt))?(t=e.charAt(Vt),Vt++):(t=i,0===Ut&&Qt(st)),t===i&&(t=Vt,n=ye(),n!==i&&(Dt=t,n=n),t=n),t}function de(){let t,n;return ot.test(e.charAt(Vt))?(t=e.charAt(Vt),Vt++):(t=i,0===Ut&&Qt(lt)),t===i&&(t=Vt,n=ye(),n!==i&&(Dt=t,n=n),t=n),t}function he(){let t,n;return ct.test(e.charAt(Vt))?(t=e.charAt(Vt),Vt++):(t=i,0===Ut&&Qt(ft)),t===i&&(t=Vt,n=ye(),n!==i&&(Dt=t,n=n),t=n),t}function ye(){let t,n,r,u,a,s,o,l;var c;return Ut++,t=Vt,"\\\\"===e.substr(Vt,2)?(n="\\\\",Vt+=2):(n=i,0===Ut&&Qt(dt)),n!==i&&(Dt=t,n="\\"),t=n,t===i&&(t=Vt,'\\"'===e.substr(Vt,2)?(n='\\"',Vt+=2):(n=i,0===Ut&&Qt(ht)),n!==i&&(Dt=t,n='"'),t=n,t===i&&(t=Vt,"\\'"===e.substr(Vt,2)?(n="\\'",Vt+=2):(n=i,0===Ut&&Qt(yt)),n!==i&&(Dt=t,n="'"),t=n,t===i&&(t=Vt,"\\`"===e.substr(Vt,2)?(n="\\`",Vt+=2):(n=i,0===Ut&&Qt(gt)),n!==i&&(Dt=t,n="`"),t=n,t===i&&(t=Vt,"\\b"===e.substr(Vt,2)?(n="\\b",Vt+=2):(n=i,0===Ut&&Qt(mt)),n!==i&&(Dt=t,n="\b"),t=n,t===i&&(t=Vt,"\\f"===e.substr(Vt,2)?(n="\\f",Vt+=2):(n=i,0===Ut&&Qt(vt)),n!==i&&(Dt=t,n="\f"),t=n,t===i&&(t=Vt,"\\n"===e.substr(Vt,2)?(n="\\n",Vt+=2):(n=i,0===Ut&&Qt(bt)),n!==i&&(Dt=t,n="\n"),t=n,t===i&&(t=Vt,"\\r"===e.substr(Vt,2)?(n="\\r",Vt+=2):(n=i,0===Ut&&Qt(wt)),n!==i&&(Dt=t,n="\r"),t=n,t===i&&(t=Vt,"\\t"===e.substr(Vt,2)?(n="\\t",Vt+=2):(n=i,0===Ut&&Qt($t)),n!==i&&(Dt=t,n="\t"),t=n,t===i&&(t=Vt,"\\u"===e.substr(Vt,2)?(n="\\u",Vt+=2):(n=i,0===Ut&&Qt(xt)),n!==i?(r=Vt,u=Vt,a=Ee(),a!==i?(s=Ee(),s!==i?(o=Ee(),o!==i?(l=Ee(),l!==i?(a=[a,s,o,l],u=a):(Vt=u,u=i)):(Vt=u,u=i)):(Vt=u,u=i)):(Vt=u,u=i),r=u!==i?e.substring(r,Vt):u,r!==i?(Dt=t,c=r,n=String.fromCharCode(parseInt(c,16)),t=n):(Vt=t,t=i)):(Vt=t,t=i)))))))))),Ut--,t===i&&(n=i,0===Ut&&Qt(pt)),t}function ge(){let t,n,r,u;return t=Vt,n=Re(),n!==i?(91===e.charCodeAt(Vt)?(r="[",Vt++):(r=i,0===Ut&&Qt(At)),r!==i?(u=Re(),u!==i?(n=[n,r,u],t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i),t}function me(){let t,n,r,u;return t=Vt,n=Re(),n!==i?(93===e.charCodeAt(Vt)?(r="]",Vt++):(r=i,0===Ut&&Qt(Rt)),r!==i?(u=Re(),u!==i?(n=[n,r,u],t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i),t}function ve(){let t,n,r,u;return t=Vt,n=Re(),n!==i?(40===e.charCodeAt(Vt)?(r="(",Vt++):(r=i,0===Ut&&Qt(Et)),r!==i?(u=Re(),u!==i?(n=[n,r,u],t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i),t}function be(){let t,n,r,u;return t=Vt,n=Re(),n!==i?(41===e.charCodeAt(Vt)?(r=")",Vt++):(r=i,0===Ut&&Qt(Ot)),r!==i?(u=Re(),u!==i?(n=[n,r,u],t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i),t}function we(){let t,n,r,u;return t=Vt,n=Re(),n!==i?(123===e.charCodeAt(Vt)?(r="{",Vt++):(r=i,0===Ut&&Qt(Ct)),r!==i?(u=Re(),u!==i?(n=[n,r,u],t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i),t}function $e(){let t,n,r,u;return t=Vt,n=Re(),n!==i?(125===e.charCodeAt(Vt)?(r="}",Vt++):(r=i,0===Ut&&Qt(Nt)),r!==i?(u=Re(),u!==i?(n=[n,r,u],t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i),t}function xe(){let t,n,r,u;return t=Vt,n=Re(),n!==i?(58===e.charCodeAt(Vt)?(r=":",Vt++):(r=i,0===Ut&&Qt(St)),r!==i?(u=Re(),u!==i?(n=[n,r,u],t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i),t}function Ae(){let t,n,r,u;return t=Vt,n=Re(),n!==i?(44===e.charCodeAt(Vt)?(r=",",Vt++):(r=i,0===Ut&&Qt(Tt)),r!==i?(u=Re(),u!==i?(n=[n,r,u],t=n):(Vt=t,t=i)):(Vt=t,t=i)):(Vt=t,t=i),t}function Re(){let t,n;for(Ut++,t=[],It.test(e.charAt(Vt))?(n=e.charAt(Vt),Vt++):(n=i,0===Ut&&Qt(kt));n!==i;)t.push(n),It.test(e.charAt(Vt))?(n=e.charAt(Vt),Vt++):(n=i,0===Ut&&Qt(kt));return Ut--,t===i&&(n=i,0===Ut&&Qt(jt)),t}function Ee(){let t,n;return Ut++,_t.test(e.charAt(Vt))?(t=e.charAt(Vt),Vt++):(t=i,0===Ut&&Qt(Jt)),Ut--,t===i&&(n=i,0===Ut&&Qt(Ft)),t}function Oe({ty:t,fn:e=null,ls:n=null}){const r={ty:t};return null!==e&&(r.fn=e),null!==n&&(r.ls=n),r}if(r=a(),r!==i&&Vt===e.length)return r;throw r!==i&&Vt<e.length&&Qt({type:"end"}),Wt(Mt,Lt<e.length?e.charAt(Lt):null,Lt<e.length?Kt(Lt,Lt+1):Kt(Lt,Lt))}}}();export const Types=new class{#t={"@arr@":{name:"array"},"@obj@":{name:"object"},"@or@":{name:"multi-type"},any:{parse:function(t){return t}},null:{parse:function(t){if(null===t)return null;const{valid:e,value:n}=Types.parse("string",t);return e&&(""===n||"null"===n.toLowerCase())?null:void 0}},num:{parse:function(t){return Types.parse("float",t)}},float:{parse:function(t){switch(typeof t){case"number":return Number.isNaN(t)?Ret.Invalid():t;case"boolean":return t?1:0;case"object":t=String(t);case"string":return t=Number(t),Number.isNaN(t)?Ret.Invalid():t;case"function":case"symbol":case"undefined":default:return}}},int:{parse:function(t){const{valid:e,value:n}=Types.parse("float",t);if(e&&Number.isInteger(n))return n}},unsigned:{parse:function(t){const{valid:e,value:n}=Types.parse("float",t);if(e&&Number.isInteger(n)&&n>=0)return n}},bool:{parse:function(t){switch(typeof t){case"boolean":return t;default:return Boolean(t)}}},string:{parse:function(t){switch(typeof t){case"string":return t;case"object":return null===t?"null":JSON.stringify(t);case"bigint":case"number":case"boolean":return new String(t).valueOf();case"undefined":return Ret.Valid("");case"function":case"symbol":default:return}}},hex:{name:"hex-string",parse:function(t){const{valid:e,value:n}=Types.parse("string",t);if(e&&/^[0-9a-f]+$/i.test(n))return Number(n)}},email:{name:"email-string",parse:function(t){const{valid:e,value:n}=Types.parse("string",t);if(e){const t=document?.createElement("input");if(null!==t){if(t.type="email",t.value=n,t.checkValidity())return n}else if(/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(n))return n}}},base64:{name:"base64-string",parse:function(t){const{valid:e,value:n}=Types.parse("string",t);if(e)try{return atob(n.replace(/-/g,"+").replace(/_/g,"/"))}catch(t){}}},json:{name:"json-string",parse:function(t){switch(typeof t){case"bigint":case"boolean":case"number":case"object":return t;case"string":try{return JSON.parse(t)}catch(t){}break;case"symbol":case"undefined":case"function":default:return}}},timestamp:{name:"timestamp-string",parse:function(t){const{valid:e,value:n}=Types.parse("string",t);if(e&&(val=new Date(n).valueOf(),NaN===val&&(val=Date.parse(n)),NaN!==val))return val}}};add({type:t,name:e=null,handler:n}){if("string"!=typeof t)throw new TypeError("Type must be a string");if(null!==e&&"string"!=typeof e)throw new TypeError("Name must be a string");if("function"!=typeof n)throw new TypeError("Handler must be a funciton");this.#t[t]={parse:n},null!==e&&(this.#t[t].name=e)}name(t){return void 0===this.#t[t]?null:this.#t[t].name??t}parse(t,e){if(void 0===this.#t[t])return Ret.Invalid(`Unknown type: ${JSON.stringify(t)}`);const n=this.#t[t].parse(e);return void 0===n?Ret.Invalid(`Expected type: '${this.name(t)}'; Received: ${JSON.stringify(e)}`):n instanceof Ret?(n.valid||(n.error??=`Expected type: '${this.name(t)}'; Received: ${JSON.stringify(e)}`),n):Ret.Valid(n)}};export const Funcs=new class{#e=[{name:"_toString",ty:["any"],fn:function(t){const{valid:e,value:n}=Types.parse("string",t);if(e)return n}},{name:"_allowed",ty:["any"],fn:function(t,...e){return e.includes(t)?t:Ret.Invalid(`Disallowed value: ${JSON.stringify(t)}`)}},{name:"_at",ty:["@arr@"],fn:function(t,...e){for(p of e)if("number"!=typeof p)throw new RangeError(`Only numeric arguments allowed; Args=${JSON.stringify(e)}`);const n=e.map((e=>t.at(e)));return 1===n.length?n[0]:n}},{name:"_slice",ty:["@obj@","any"],fn:function(t,...e){const n=[];for(const r of e)Object.hasOwn(t,r)&&n.push([r,t[r]]);switch(e.length){case 0:return null;case 1:return 0===n.length?null:n[0][1];default:return Object.fromEntries(n)}}},{name:"_title",ty:["string"],fn:function(t){return t.replace(/\w\S*/g,(t=>`${t.charAt(0).toUpperCase()}${t.substring(1).toLowerCase()}`))}},{name:"_range",ty:["float","num","int","unsigned"],fn:function(t,e=null,n=null){if(null!==e&&"number"!=typeof e)throw new TypeError("Only null or number allowed as arguments");if(null!==n&&"number"!=typeof n)throw new TypeError("Only null or number allowed as arguments");return null!==e&&t<e||null!==n&&t>n?Ret.Invalid(`Expected range [${e??"null"}, ${n??"null"}]`):t}},{name:"_add",ty:["float","num","int","unsigned"],fn:function(t,e=0){if("number"==typeof e)return t+e;throw new TypeError("Only numeric argument allowed")}},{name:"_sub",ty:["float","num","int","unsigned"],fn:function(t,e=0){if("number"==typeof e)return t-e;throw new TypeError("Only numeric argument allowed")}},{name:"_mul",ty:["float","num","int","unsigned"],fn:function(t,e=1){if("number"==typeof e)return t*e;throw new TypeError("Only numeric argument allowed")}},{name:"_div",ty:["float","num","int","unsigned"],fn:function(t,e=1){if("number"==typeof e&&0!==e)return t/e;throw new TypeError("Only non-zero numeric argument allowed")}},{name:"_mod",ty:["float","num","int","unsigned"],fn:function(t,e){if("number"==typeof e&&0!==e)return t%e;throw new TypeError("Only non-zero numeric argument allowed")}},{name:"_exp",ty:["float","num","int","unsigned"],fn:function(t,e=1){if("number"==typeof e)return t**e;throw new TypeError("Only numeric argument allowed")}},{name:"_round",ty:["float","num","int","unsigned"],fn:function(t,e=2){if("number"==typeof e)return Number(t.toFixed(e));throw new TypeError("Only numeric argument allowed")}}];#n=[];constructor(){this.reInit()}add(t,e,...n){if("function"!=typeof t)throw new TypeError("Invalid handler");if("string"!=typeof e)throw new TypeError("Invalid name");for(const t of n)if(null===Types.name(t))throw new TypeError(`Invalid type: ${JSON.stringify(t)}`);"_"!==e.at()&&(e=`_${e}`),this.#e.push({name:e,ty:n,fn:t}),this.reInit()}reInit(){this.#n=this.#e.map((({name:t,ty:e})=>e.map((e=>`${e}.${t}`)))).flat(1)}exists(t,e){return this.#n.includes(`${t}.${e}`)?1:!!this.#n.includes(`any.${e}`)&&2}getFn(t,e){let n;switch(this.exists(t,e)){case!1:return null;case 1:n=t;break;case 2:n="any";break}for(const t of this.#e)if(t.name===e&&t.ty.includes(n))return t.fn;return null}runFn(t,e,n,r){if("_"===e.at()){const i=this.getFn(t,e);if("function"!=typeof i)return Ret.Invalid(`Function missing: "${t}.${e}";`);try{const u=i(n,...r);return void 0===u?Ret.Invalid(`Function ${t}.${e} Error; Failed; Received: ${JSON.stringify(n)}`):u instanceof Ret?(u.valid||(u.error=`Function ${t}.${e} Error; ${u.error??""}; Received: ${JSON.stringify(n)}`),u):Ret.Valid(u)}catch(r){return Ret.Invalid(`Function ${t}.${e} Error; ${r.message}; Received: ${JSON.stringify(n)}`)}}else{if("function"!=typeof n[e])return Ret.Invalid(`There is no native function '${e}' for type '${Object.prototype.toString.call(n)}'`);try{const t=n[e](...r);return Ret.Valid(t)}catch(r){return Ret.Invalid(`Function ${t}.${e} Error; ${r.message}; Received: ${JSON.stringify(n)}`)}}}};export class DataValidator{static New(t,...e){function n(t){switch(typeof t){case"object":return JSON.stringify(t);case"function":return n(t());default:return String(t)}}let r=[];for(let i=0,u=t.length-1;i<u;i++)r.push(t[i]),r.push(n(e[i]));r.push(t[t.length-1]),r=r.join("");try{const t=new DataValidator(Parser.parse(r));return t.__structureSyntax__=r,t}catch(t){throw t instanceof Parser.SyntaxError?new Error(`Parse Error; Line:${t.location.start.line}; Column:${t.location.start.column}; ${t.message}`):new Error(t.message)}}static#r(t){t.idx=-1,t.len=t.length-1,t.rpt=0,t.next=function(t=!1){return 0===this.rpt?(this.idx++,this.rpt="reset",this.idx>this.len?"error":this.next()):"reset"===this.rpt?(this.rpt=this[this.idx].rpt??1,this.next(t)):"yes"===this.rpt?t?this.idx===this.len?"error":(this.rpt=0,this.next(t)):this[this.idx]:(this.rpt--,this[this.idx])}}static#i(t,e=0){if(!isObject(t))return Ret.Invalid("Not an object");const{ty:n=null,fn:r=[],nx:i=null}=t;if("string"!=typeof n||null===Types.name(n))return Ret.Invalid(`Unknown type: ${JSON.stringify(n)}`);{let r=null;switch(n){case"@obj@":r=t=>`{${t}}`;break;case"@arr@":r=t=>`[${t}]`;break;case"@or@":r=t=>"(multi-type)";break;default:break}if(null!==r){const n=t.ls??[];for(const[t,i]of Object.entries(n)){const n=DataValidator.#i(i,e+1);if(!n.valid)return n.error=`${r(t)}: ${n.error}`,n}}}for(const t of r)if("_"===t.fn.at()&&!Funcs.exists(n,t.fn))return Ret.Invalid(`Unknown Function: '${n}.${t.fn}'`);if(null!==i){const t=DataValidator.#i(i,e+1);if(!t.valid)return t.error=`${Types.name(n)}\n=> ${t.error}`,t}return Ret.Valid()}#u;constructor(t,e=!0){if(e){const e=DataValidator.#i(t);if(null!==e.error)throw new Error(`StructError: ${e.error}`)}this.#u=t}get struct(){return this.#u}validate(t){return DataValidator.#a(t,this.#u)}static#a(t,e,n=0){const{ty:r=null,fn:i=[],nx:u=null}=e;switch(r){case"@arr@":{if(!Array.isArray(t))return Ret.Invalid(`Expected array; Received ${JSON.stringify(t)};`);const r=[],i=e.ls??[];DataValidator.#r(i);let u=i.next();const a=Object.entries(t);for(let t=0,e=a.length;t<e;t++){const[e,s]=a[t];if("error"===u)return Ret.Invalid(`[${e}] Index out of bounds`);let o=DataValidator.#a(s,u,n+1);if(!o.valid){if("many"===i.more&&i.idx!==i.len){u=i.next(!0),t--;continue}return Ret.Invalid(`[${e}]: ${o.error}`)}r.push(o.value),u=i.next()}t=r}break;case"@obj@":{if(!isObject(t))return Ret.Invalid(`Expected object; Received ${JSON.stringify(t)};`);const r=e.ls??{};for(const[e,{def:n}]of Object.entries(r))void 0!==n&&void 0===t[e]&&(t[e]=n);const i=Object.keys(r);{const e=i.filter((t=>r[t].rq??!1)),n=Object.keys(t),u=[];for(const t of e)n.includes(t)||u.push(`{${t}}`);if(0!==u.length)return Ret.Invalid(`Missing object key(s): ${u.join(", ")}; Received ${JSON.stringify(t)};`)}const u=e.kp??!1,a={};for(const[e,s]of Object.entries(t))if(i.includes(e)){const t=DataValidator.#a(s,r[e],n+1);if(!t.valid)return Ret.Invalid(`{${e}}: ${t.error}`);a[e]=t.value}else u&&(a[e]=s);t=a}break;case"@or@":{const r=e.ls??[];let i=null;for(const e of r)if(i=DataValidator.#a(t,e,n+1),i.valid)break;if(null===i||!i.valid)return Ret.Invalid(`Expected type(s): (${r.map((t=>t.ty??"undefined")).join("|")}); Received: ${JSON.stringify(t)};`);t=i.value}break;default:{const e=Types.parse(r,t);if(!e.valid)return Ret.Invalid(`Expected type: ${Types.getName(r)}; Received: ${JSON.stringify(t)};`);t=e.value}break}for(const e of i){let{fn:n="undefined",args:i=[]}=e;const u=Funcs.runFn(r,n,t,i);if(!u.valid)return u.error??=`Cannot convert ${JSON.stringify(t)};`,Ret.Invalid(`Formatter '${Types.name(r)}.${n}' error: ${u.error}`);t=u.value}if(null!==u){const e=DataValidator.#a(t,u,n+1);if(!e.valid)return e.error=`${Types.name(r)}\n=> ${e.error}`,e;t=e.value}return Ret.Valid(t)}}