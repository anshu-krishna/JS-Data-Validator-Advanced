function isObject(t){return null!==t&&"object"==typeof t}export class Ret{value;valid;error;constructor(t,e){t=!!t,this.valid=t,this.value=t?e:null,this.error=t?null:e}static Valid(t=null){return new Ret(!0,t)}static Invalid(t=null){return new Ret(!1,t)}}export const Parser=function(){"use strict";function t(e,r,n,i){this.message=e,this.expected=r,this.found=n,this.location=i,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}return function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(t,Error),t.buildMessage=function(t,e){let r={literal:function(t){return'"'+i(t.text)+'"'},class:function(t){let e,r="";for(e=0;e<t.parts.length;e++)r+=t.parts[e]instanceof Array?s(t.parts[e][0])+"-"+s(t.parts[e][1]):s(t.parts[e]);return"["+(t.inverted?"^":"")+r+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function i(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function s(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}return"Expected "+function(t){let e,n,i=new Array(t.length);for(e=0;e<t.length;e++)i[e]=(s=t[e],r[s.type](s));var s;if(i.sort(),i.length>0){for(e=1,n=1;e<i.length;e++)i[e-1]!==i[e]&&(i[n]=i[e],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+i(t)+'"':"end of input"}(e)+" found."},{SyntaxError:t,parse:function(e,r){r=void 0!==r?r:{};let n,i={},s={Format:we},a=we,u="=>",o=pe("=>",!1),l=function(t,e){return e},c=function(t,e){return function(t,e){let r=[t,...e];for(;r.length>1;){const t=r.pop();r[r.length-1].nx=t}return r[0]}(t,e)},f=pe("|",!1),h=function(t,e){return e},d=function(t,e){return Object.fromEntries([t,...e])},p="...",y=pe("...",!1),g=ge("identifier:data-type pair"),m=pe("?",!1),b=pe("=",!1),v=ge("repeat-count"),A="..",w=pe("..",!1),$=ge("function-list"),x=function(t,e){return[t,...e]},R=ge("function"),C=".",E=pe(".",!1),O=ge("object"),I=function(t,e){return e},S=ge("key:val pair"),N=ge("key"),T=ge("identifier"),j=/^[_a-z$]/i,F=ye(["_",["a","z"],"$"],!1,!0),k=/^[0-9a-z$_]/i,_=ye([["0","9"],["a","z"],"$","_"],!1,!0),J=ge("value-list"),V=ge("null"),D="null",U=pe("null",!1),M=ge("undefined"),z="undefined",L=pe("undefined",!1),P=(ge("bool"),"false"),q=pe("false",!1),B="true",H=pe("true",!1),G=ge("number"),K="-",Q=pe("-",!1),W=pe("0x",!1),X=pe("0o",!1),Y=/^[0-7]/,Z=ye([["0","7"]],!1,!1),tt=pe("0b",!1),et=/^[0-1]/,rt=ye([["0","1"]],!1,!1),nt=/^[eE]/,it=ye(["e","E"],!1,!1),st=pe("+",!1),at=function(){return parseFloat(e.substring(le,oe))},ut=ge("string"),ot=pe('"',!1),lt=/^[^\0-\x1F\\"]/,ct=ye([["\0",""],"\\",'"'],!0,!1),ft=function(t){return t.join("")},ht=pe("'",!1),dt=/^[^\0-\x1F\\']/,pt=ye([["\0",""],"\\","'"],!0,!1),yt=pe("`",!1),gt=/^[^\0-\x1F\\`]/,mt=ye([["\0",""],"\\","`"],!0,!1),bt=pe("\\\\",!1),vt=pe('\\"',!1),At=pe("\\'",!1),wt=pe("\\`",!1),$t=pe("\\b",!1),xt=pe("\\f",!1),Rt=pe("\\n",!1),Ct=pe("\\r",!1),Et=pe("\\t",!1),Ot=pe("\\0",!1),It=pe("\\x",!1),St=function(t){return String.fromCharCode(parseInt(t,16))},Nt=pe("\\u",!1),Tt=/^[\n]/,jt=ye(["\n"],!1,!1),Ft=/^[\t]/,kt=ye(["\t"],!1,!1),_t=ge("whitespace"),Jt=/^[ \t\n\r]/,Vt=ye([" ","\t","\n","\r"],!1,!1),Dt=ge("Comment"),Ut=pe("/*",!1),Mt=/^[^*]/,zt=ye(["*"],!0,!1),Lt=pe("*",!1),Pt=/^[\/]/,qt=ye(["/"],!1,!1),Bt=pe("*/",!1),Ht=pe("//",!1),Gt=/^[^\n]/,Kt=ye(["\n"],!0,!1),Qt=ge("Hex-Char"),Wt=/^[0-9a-f]/i,Xt=ye([["0","9"],["a","f"]],!1,!0),Yt=/^[0-9]/,Zt=ye([["0","9"]],!1,!1),te=pe(",",!1),ee=pe(":",!1),re=pe("[",!1),ne=pe("]",!1),ie=pe("{",!1),se=pe("}",!1),ae=pe("(",!1),ue=pe(")",!1),oe=0,le=0,ce=[{line:1,column:1}],fe=0,he=[],de=0;if("startRule"in r){if(!(r.startRule in s))throw new Error("Can't start parsing from rule \""+r.startRule+'".');a=s[r.startRule]}function pe(t,e){return{type:"literal",text:t,ignoreCase:e}}function ye(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function ge(t){return{type:"other",description:t}}function me(t){let r,n=ce[t];if(n)return n;for(r=t-1;!ce[r];)r--;for(n=ce[r],n={line:n.line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return ce[t]=n,n}function be(t,e){let r=me(t),n=me(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function ve(t){oe<fe||(oe>fe&&(fe=oe,he=[]),he.push(t))}function Ae(e,r,n){return new t(t.buildMessage(e,r),e,r,n)}function we(){let t,r,n,s,a,f,h,d,p;if(t=oe,r=He(),r!==i)if(n=$e(),n!==i){for(s=[],a=oe,f=Je(),f!==i?(e.substr(oe,2)===u?(h=u,oe+=2):(h=i,0===de&&ve(o)),h!==i?(d=Je(),d!==i?(p=$e(),p!==i?(le=a,f=l(0,p),a=f):(oe=a,a=i)):(oe=a,a=i)):(oe=a,a=i)):(oe=a,a=i);a!==i;)s.push(a),a=oe,f=Je(),f!==i?(e.substr(oe,2)===u?(h=u,oe+=2):(h=i,0===de&&ve(o)),h!==i?(d=Je(),d!==i?(p=$e(),p!==i?(le=a,f=l(0,p),a=f):(oe=a,a=i)):(oe=a,a=i)):(oe=a,a=i)):(oe=a,a=i);s!==i?(a=Ge(),a!==i?(le=t,r=c(n,s),t=r):(oe=t,t=i)):(oe=t,t=i)}else oe=t,t=i;else oe=t,t=i;if(t===i){if(t=oe,r=$e(),r!==i){for(n=[],s=oe,a=Je(),a!==i?(e.substr(oe,2)===u?(f=u,oe+=2):(f=i,0===de&&ve(o)),f!==i?(h=Je(),h!==i?(d=$e(),d!==i?(le=s,a=l(0,d),s=a):(oe=s,s=i)):(oe=s,s=i)):(oe=s,s=i)):(oe=s,s=i);s!==i;)n.push(s),s=oe,a=Je(),a!==i?(e.substr(oe,2)===u?(f=u,oe+=2):(f=i,0===de&&ve(o)),f!==i?(h=Je(),h!==i?(d=$e(),d!==i?(le=s,a=l(0,d),s=a):(oe=s,s=i)):(oe=s,s=i)):(oe=s,s=i)):(oe=s,s=i);n!==i?(le=t,r=c(r,n),t=r):(oe=t,t=i)}else oe=t,t=i;t===i&&(t=oe,r=Je(),r!==i?(n=$e(),n!==i?(s=Je(),s!==i?(r=[r,n,s],t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i))}return t}function $e(){let t,r,n,s,a,u,o,l,c;if(t=oe,r=He(),r!==i)if(n=we(),n!==i){for(s=[],a=oe,u=Je(),u!==i?(124===e.charCodeAt(oe)?(o="|",oe++):(o=i,0===de&&ve(f)),o!==i?(l=Je(),l!==i?(c=we(),c!==i?(le=a,u=h(0,c),a=u):(oe=a,a=i)):(oe=a,a=i)):(oe=a,a=i)):(oe=a,a=i);a!==i;)s.push(a),a=oe,u=Je(),u!==i?(124===e.charCodeAt(oe)?(o="|",oe++):(o=i,0===de&&ve(f)),o!==i?(l=Je(),l!==i?(c=we(),c!==i?(le=a,u=h(0,c),a=u):(oe=a,a=i)):(oe=a,a=i)):(oe=a,a=i)):(oe=a,a=i);s!==i?(a=Ge(),a!==i?(u=Ce(),u===i&&(u=null),u!==i?(le=t,r=function(t,e,r){const n=[t,...e];if(1===n.length){let t=[...n[0]?.fn??[],...r??[]];return 0===t.length&&(t=null),Ke({...n[0],fn:t})}return Ke({ty:"@or@",ls:n,fn:r})}(n,s,u),t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i)}else oe=t,t=i;else oe=t,t=i;if(t===i){if(t=oe,r=Le(),r!==i){if(n=oe,s=Re(),s!==i){for(a=[],u=oe,o=Me(),o!==i?(l=Re(),l!==i?(le=u,o=h(0,l),u=o):(oe=u,u=i)):(oe=u,u=i);u!==i;)a.push(u),u=oe,o=Me(),o!==i?(l=Re(),l!==i?(le=u,o=h(0,l),u=o):(oe=u,u=i)):(oe=u,u=i);a!==i?(u=Me(),u===i&&(u=null),u!==i?(le=n,g=a,s=[s,...g],n=s):(oe=n,n=i)):(oe=n,n=i)}else oe=n,n=i;n===i&&(n=null),n!==i?(s=Pe(),s!==i?(a=Ce(),a===i&&(a=null),a!==i?(le=t,r=Ke({ty:"@arr@",ls:n??[],fn:a}),t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i)}else oe=t,t=i;if(t===i){if(t=oe,r=qe(),r!==i){if(n=oe,s=xe(),s!==i){for(a=[],u=oe,o=Me(),o!==i?(l=xe(),l!==i?(le=u,o=h(0,l),u=o):(oe=u,u=i)):(oe=u,u=i);u!==i;)a.push(u),u=oe,o=Me(),o!==i?(l=xe(),l!==i?(le=u,o=h(0,l),u=o):(oe=u,u=i)):(oe=u,u=i);a!==i?(le=n,s=d(s,a),n=s):(oe=n,n=i)}else oe=n,n=i;n===i&&(n=null),n!==i?(s=oe,a=Me(),a!==i?(e.substr(oe,3)===p?(u=p,oe+=3):(u=i,0===de&&ve(y)),u!==i?(a=[a,u],s=a):(oe=s,s=i)):(oe=s,s=i),s===i&&(s=null),s!==i?(a=Me(),a===i&&(a=null),a!==i?(u=Be(),u!==i?(o=Ce(),o===i&&(o=null),o!==i?(le=t,r=function(t,e,r){const n=Ke({ty:"@obj@",ls:t,fn:r});return e&&(n.kp=!0),n}(n,s,o),t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i)}else oe=t,t=i;t===i&&(t=oe,r=Se(),r!==i?(n=Ce(),n===i&&(n=null),n!==i?(le=t,r=function(t,e){return Ke({ty:t,fn:e})}(r,n),t=r):(oe=t,t=i)):(oe=t,t=i))}}var g;return t}function xe(){let t,r,n,s,a,u,o,l,c,f;var h,d,p;return de++,t=oe,63===e.charCodeAt(oe)?(r="?",oe++):(r=i,0===de&&ve(m)),r===i&&(r=null),r!==i?(n=Se(),n===i&&(n=ke()),n!==i?(s=oe,a=He(),a!==i?(u=Je(),u!==i?(61===e.charCodeAt(oe)?(o="=",oe++):(o=i,0===de&&ve(b)),o!==i?(l=Je(),l!==i?(c=Oe(),c!==i?(f=Ge(),f!==i?(le=s,a={val:c},s=a):(oe=s,s=i)):(oe=s,s=i)):(oe=s,s=i)):(oe=s,s=i)):(oe=s,s=i)):(oe=s,s=i),s===i&&(s=null),s!==i?(a=ze(),a!==i?(u=we(),u!==i?(le=t,h=n,d=s,p=u,null===r&&(p.rq=!0),null!==d&&(p.def=d.val),r=[h,p],t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i),de--,t===i&&(r=i,0===de&&ve(g)),t}function Re(){let t,r,n;var s,a;return t=oe,r=function(){let t,r,n,s,a;de++,t=oe,e.substr(oe,2)===A?(r=A,oe+=2):(r=i,0===de&&ve(w));r!==i?(n=Fe(),n!==i?(e.substr(oe,2)===A?(s=A,oe+=2):(s=i,0===de&&ve(w)),s!==i?(a=Je(),a!==i?(le=t,u=n,r=Math.floor(Math.abs(u)),t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i);var u;t===i&&(t=oe,e.substr(oe,3)===p?(r=p,oe+=3):(r=i,0===de&&ve(y)),r!==i?(n=Je(),n!==i?(le=t,r="yes",t=r):(oe=t,t=i)):(oe=t,t=i));de--,t===i&&(r=i,0===de&&ve(v));return t}(),r===i&&(r=null),r!==i?(n=we(),n!==i?(le=t,a=n,(s=r)&&(a.rpt=s),r=a,t=r):(oe=t,t=i)):(oe=t,t=i),t}function Ce(){let t,e,r,n;if(de++,t=oe,e=Ee(),e!==i){for(r=[],n=Ee();n!==i;)r.push(n),n=Ee();r!==i?(le=t,e=x(e,r),t=e):(oe=t,t=i)}else oe=t,t=i;return de--,t===i&&(e=i,0===de&&ve($)),t}function Ee(){let t,r,n,s,a,u,o,l,c;return de++,t=oe,r=Je(),r!==i?(46===e.charCodeAt(oe)?(n=C,oe++):(n=i,0===de&&ve(E)),n!==i?(s=Se(),s!==i?(a=oe,u=He(),u!==i?(o=Ne(),o===i&&(o=null),o!==i?(l=Me(),l===i&&(l=null),l!==i?(c=Ge(),c!==i?(le=a,u=o,a=u):(oe=a,a=i)):(oe=a,a=i)):(oe=a,a=i)):(oe=a,a=i),a===i&&(a=null),a!==i?(le=t,r=function(t,e){const r={fn:t};return e&&(r.args=e),r}(s,a),t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i),de--,t===i&&(r=i,0===de&&ve(R)),t}function Oe(){let t,r,n,s;return t=oe,r=Je(),r!==i?(n=function(){let t,r;de++,t=oe,e.substr(oe,4)===D?(r=D,oe+=4):(r=i,0===de&&ve(U));r!==i&&(le=t,r=null);t=r,de--,t===i&&(r=i,0===de&&ve(V));return t}(),n===i&&(n=function(){let t,r;de++,t=oe,e.substr(oe,9)===z?(r=z,oe+=9):(r=i,0===de&&ve(L));r!==i&&(le=t,r=void 0);t=r,de--,t===i&&(r=i,0===de&&ve(M));return t}(),n===i&&(n=je(),n===i&&(n=Te(),n===i&&(n=Fe(),n===i&&(n=ke()))))),n!==i?(s=Je(),s!==i?(le=t,r=n,t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i),t===i&&(t=function(){let t,e,r,n,s,a,u,o;if(de++,t=oe,e=qe(),e!==i){if(r=oe,n=Ie(),n!==i){for(s=[],a=oe,u=Me(),u!==i?(o=Ie(),o!==i?(le=a,u=I(0,o),a=u):(oe=a,a=i)):(oe=a,a=i);a!==i;)s.push(a),a=oe,u=Me(),u!==i?(o=Ie(),o!==i?(le=a,u=I(0,o),a=u):(oe=a,a=i)):(oe=a,a=i);s!==i?(le=r,n=d(n,s),r=n):(oe=r,r=i)}else oe=r,r=i;r===i&&(r=null),r!==i?(n=Me(),n===i&&(n=null),n!==i?(s=Be(),s!==i?(le=t,e=null!==(l=r)?l:{},t=e):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i)}else oe=t,t=i;var l;de--,t===i&&(e=i,0===de&&ve(O));return t}(),t===i&&(t=function(){let t,e,r,n,s;t=oe,e=Le(),e!==i?(r=Ne(),r===i&&(r=null),r!==i?(n=Me(),n===i&&(n=null),n!==i?(s=Pe(),s!==i?(le=t,e=r??[],t=e):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i);return t}())),t}function Ie(){let t,r,n,s;return de++,t=oe,r=ke(),r===i&&(r=function(){let t,r,n,s,a,u,o;if(de++,t=oe,r=oe,n=Se(),n!==i){for(s=[],a=oe,46===e.charCodeAt(oe)?(u=C,oe++):(u=i,0===de&&ve(E)),u!==i?(o=Se(),o!==i?(u=[u,o],a=u):(oe=a,a=i)):(oe=a,a=i);a!==i;)s.push(a),a=oe,46===e.charCodeAt(oe)?(u=C,oe++):(u=i,0===de&&ve(E)),u!==i?(o=Se(),o!==i?(u=[u,o],a=u):(oe=a,a=i)):(oe=a,a=i);s!==i?(n=[n,s],r=n):(oe=r,r=i)}else oe=r,r=i;t=r!==i?e.substring(t,oe):r;de--,t===i&&(r=i,0===de&&ve(N));return t}()),r!==i?(n=ze(),n!==i?(s=Oe(),s!==i?(le=t,r=[r,s],t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i),de--,t===i&&(r=i,0===de&&ve(S)),t}function Se(){let t,r,n,s,a;if(de++,t=oe,r=oe,j.test(e.charAt(oe))?(n=e.charAt(oe),oe++):(n=i,0===de&&ve(F)),n!==i){for(s=[],k.test(e.charAt(oe))?(a=e.charAt(oe),oe++):(a=i,0===de&&ve(_));a!==i;)s.push(a),k.test(e.charAt(oe))?(a=e.charAt(oe),oe++):(a=i,0===de&&ve(_));s!==i?(n=[n,s],r=n):(oe=r,r=i)}else oe=r,r=i;return t=r!==i?e.substring(t,oe):r,de--,t===i&&(r=i,0===de&&ve(T)),t}function Ne(){let t,e,r,n,s,a;if(de++,t=oe,e=Oe(),e!==i){for(r=[],n=oe,s=Me(),s!==i?(a=Oe(),a!==i?(le=n,s=h(0,a),n=s):(oe=n,n=i)):(oe=n,n=i);n!==i;)r.push(n),n=oe,s=Me(),s!==i?(a=Oe(),a!==i?(le=n,s=h(0,a),n=s):(oe=n,n=i)):(oe=n,n=i);r!==i?(le=t,e=x(e,r),t=e):(oe=t,t=i)}else oe=t,t=i;return de--,t===i&&(e=i,0===de&&ve(J)),t}function Te(){let t,r;return t=oe,e.substr(oe,5)===P?(r=P,oe+=5):(r=i,0===de&&ve(q)),r!==i&&(le=t,r=!1),t=r,t}function je(){let t,r;return t=oe,e.substr(oe,4)===B?(r=B,oe+=4):(r=i,0===de&&ve(H)),r!==i&&(le=t,r=!0),t=r,t}function Fe(){let t,r,n,s,a,u,o,l,c;if(de++,t=oe,45===e.charCodeAt(oe)?(r=K,oe++):(r=i,0===de&&ve(Q)),r===i&&(r=null),r!==i)if("0x"===e.substr(oe,2)?(n="0x",oe+=2):(n=i,0===de&&ve(W)),n!==i){if(s=oe,a=[],u=De(),u!==i)for(;u!==i;)a.push(u),u=De();else a=i;s=a!==i?e.substring(s,oe):a,s!==i?(le=t,r=parseInt(`${r??""}${s}`,16),t=r):(oe=t,t=i)}else oe=t,t=i;else oe=t,t=i;if(t===i){if(t=oe,45===e.charCodeAt(oe)?(r=K,oe++):(r=i,0===de&&ve(Q)),r===i&&(r=null),r!==i)if("0o"===e.substr(oe,2)?(n="0o",oe+=2):(n=i,0===de&&ve(X)),n!==i){if(s=oe,a=[],Y.test(e.charAt(oe))?(u=e.charAt(oe),oe++):(u=i,0===de&&ve(Z)),u!==i)for(;u!==i;)a.push(u),Y.test(e.charAt(oe))?(u=e.charAt(oe),oe++):(u=i,0===de&&ve(Z));else a=i;s=a!==i?e.substring(s,oe):a,s!==i?(le=t,r=function(t,e){return parseInt(`${t??""}${e}`,8)}(r,s),t=r):(oe=t,t=i)}else oe=t,t=i;else oe=t,t=i;if(t===i){if(t=oe,45===e.charCodeAt(oe)?(r=K,oe++):(r=i,0===de&&ve(Q)),r===i&&(r=null),r!==i)if("0b"===e.substr(oe,2)?(n="0b",oe+=2):(n=i,0===de&&ve(tt)),n!==i){if(s=oe,a=[],et.test(e.charAt(oe))?(u=e.charAt(oe),oe++):(u=i,0===de&&ve(rt)),u!==i)for(;u!==i;)a.push(u),et.test(e.charAt(oe))?(u=e.charAt(oe),oe++):(u=i,0===de&&ve(rt));else a=i;s=a!==i?e.substring(s,oe):a,s!==i?(le=t,r=function(t,e){return parseInt(`${t??""}${e}`,2)}(r,s),t=r):(oe=t,t=i)}else oe=t,t=i;else oe=t,t=i;if(t===i)if(t=oe,45===e.charCodeAt(oe)?(r=K,oe++):(r=i,0===de&&ve(Q)),r===i&&(r=null),r!==i){if(n=[],s=Ue(),s!==i)for(;s!==i;)n.push(s),s=Ue();else n=i;if(n!==i){if(s=oe,46===e.charCodeAt(oe)?(a=C,oe++):(a=i,0===de&&ve(E)),a!==i){if(u=[],o=Ue(),o!==i)for(;o!==i;)u.push(o),o=Ue();else u=i;u!==i?(a=[a,u],s=a):(oe=s,s=i)}else oe=s,s=i;if(s===i&&(s=null),s!==i){if(a=oe,nt.test(e.charAt(oe))?(u=e.charAt(oe),oe++):(u=i,0===de&&ve(it)),u!==i)if(45===e.charCodeAt(oe)?(o=K,oe++):(o=i,0===de&&ve(Q)),o===i&&(43===e.charCodeAt(oe)?(o="+",oe++):(o=i,0===de&&ve(st))),o===i&&(o=null),o!==i){if(l=[],c=Ue(),c!==i)for(;c!==i;)l.push(c),c=Ue();else l=i;l!==i?(u=[u,o,l],a=u):(oe=a,a=i)}else oe=a,a=i;else oe=a,a=i;a===i&&(a=null),a!==i?(le=t,r=at(),t=r):(oe=t,t=i)}else oe=t,t=i}else oe=t,t=i}else oe=t,t=i}}return de--,t===i&&(r=i,0===de&&ve(G)),t}function ke(){let t,r,n,s;if(de++,t=oe,34===e.charCodeAt(oe)?(r='"',oe++):(r=i,0===de&&ve(ot)),r!==i){for(n=[],lt.test(e.charAt(oe))?(s=e.charAt(oe),oe++):(s=i,0===de&&ve(ct)),s===i&&(s=_e());s!==i;)n.push(s),lt.test(e.charAt(oe))?(s=e.charAt(oe),oe++):(s=i,0===de&&ve(ct)),s===i&&(s=_e());n!==i?(34===e.charCodeAt(oe)?(s='"',oe++):(s=i,0===de&&ve(ot)),s!==i?(le=t,r=ft(n),t=r):(oe=t,t=i)):(oe=t,t=i)}else oe=t,t=i;if(t===i){if(t=oe,39===e.charCodeAt(oe)?(r="'",oe++):(r=i,0===de&&ve(ht)),r!==i){for(n=[],dt.test(e.charAt(oe))?(s=e.charAt(oe),oe++):(s=i,0===de&&ve(pt)),s===i&&(s=_e());s!==i;)n.push(s),dt.test(e.charAt(oe))?(s=e.charAt(oe),oe++):(s=i,0===de&&ve(pt)),s===i&&(s=_e());n!==i?(39===e.charCodeAt(oe)?(s="'",oe++):(s=i,0===de&&ve(ht)),s!==i?(le=t,r=ft(n),t=r):(oe=t,t=i)):(oe=t,t=i)}else oe=t,t=i;if(t===i)if(t=oe,96===e.charCodeAt(oe)?(r="`",oe++):(r=i,0===de&&ve(yt)),r!==i){for(n=[],gt.test(e.charAt(oe))?(s=e.charAt(oe),oe++):(s=i,0===de&&ve(mt)),s===i&&(s=_e());s!==i;)n.push(s),gt.test(e.charAt(oe))?(s=e.charAt(oe),oe++):(s=i,0===de&&ve(mt)),s===i&&(s=_e());n!==i?(96===e.charCodeAt(oe)?(s="`",oe++):(s=i,0===de&&ve(yt)),s!==i?(le=t,r=ft(n),t=r):(oe=t,t=i)):(oe=t,t=i)}else oe=t,t=i}return de--,t===i&&(r=i,0===de&&ve(ut)),t}function _e(){let t,r,n,s,a,u,o,l;var c;return t=oe,"\\\\"===e.substr(oe,2)?(r="\\\\",oe+=2):(r=i,0===de&&ve(bt)),r!==i&&(le=t,r="\\"),t=r,t===i&&(t=oe,'\\"'===e.substr(oe,2)?(r='\\"',oe+=2):(r=i,0===de&&ve(vt)),r!==i&&(le=t,r='"'),t=r,t===i&&(t=oe,"\\'"===e.substr(oe,2)?(r="\\'",oe+=2):(r=i,0===de&&ve(At)),r!==i&&(le=t,r="'"),t=r,t===i&&(t=oe,"\\`"===e.substr(oe,2)?(r="\\`",oe+=2):(r=i,0===de&&ve(wt)),r!==i&&(le=t,r="`"),t=r,t===i&&(t=oe,"\\b"===e.substr(oe,2)?(r="\\b",oe+=2):(r=i,0===de&&ve($t)),r!==i&&(le=t,r="\b"),t=r,t===i&&(t=oe,"\\f"===e.substr(oe,2)?(r="\\f",oe+=2):(r=i,0===de&&ve(xt)),r!==i&&(le=t,r="\f"),t=r,t===i&&(t=oe,"\\n"===e.substr(oe,2)?(r="\\n",oe+=2):(r=i,0===de&&ve(Rt)),r!==i&&(le=t,r="\n"),t=r,t===i&&(t=oe,"\\r"===e.substr(oe,2)?(r="\\r",oe+=2):(r=i,0===de&&ve(Ct)),r!==i&&(le=t,r="\r"),t=r,t===i&&(t=oe,"\\t"===e.substr(oe,2)?(r="\\t",oe+=2):(r=i,0===de&&ve(Et)),r!==i&&(le=t,r="\t"),t=r,t===i&&(t=oe,"\\0"===e.substr(oe,2)?(r="\\0",oe+=2):(r=i,0===de&&ve(Ot)),r!==i?(n=oe,s=oe,Y.test(e.charAt(oe))?(a=e.charAt(oe),oe++):(a=i,0===de&&ve(Z)),a!==i?(Y.test(e.charAt(oe))?(u=e.charAt(oe),oe++):(u=i,0===de&&ve(Z)),u===i&&(u=null),u!==i?(Y.test(e.charAt(oe))?(o=e.charAt(oe),oe++):(o=i,0===de&&ve(Z)),o===i&&(o=null),o!==i?(a=[a,u,o],s=a):(oe=s,s=i)):(oe=s,s=i)):(oe=s,s=i),n=s!==i?e.substring(n,oe):s,n!==i?(le=t,c=n,r=String.fromCharCode(parseInt(c,8)),t=r):(oe=t,t=i)):(oe=t,t=i),t===i&&(t=oe,"\\x"===e.substr(oe,2)?(r="\\x",oe+=2):(r=i,0===de&&ve(It)),r!==i?(n=oe,s=oe,a=De(),a!==i?(u=De(),u!==i?(a=[a,u],s=a):(oe=s,s=i)):(oe=s,s=i),n=s!==i?e.substring(n,oe):s,n!==i?(le=t,r=St(n),t=r):(oe=t,t=i)):(oe=t,t=i),t===i&&(t=oe,"\\u"===e.substr(oe,2)?(r="\\u",oe+=2):(r=i,0===de&&ve(Nt)),r!==i?(n=oe,s=oe,a=De(),a!==i?(u=De(),u!==i?(o=De(),o!==i?(l=De(),l!==i?(a=[a,u,o,l],s=a):(oe=s,s=i)):(oe=s,s=i)):(oe=s,s=i)):(oe=s,s=i),n=s!==i?e.substring(n,oe):s,n!==i?(le=t,r=St(n),t=r):(oe=t,t=i)):(oe=t,t=i),t===i&&(Tt.test(e.charAt(oe))?(t=e.charAt(oe),oe++):(t=i,0===de&&ve(jt)),t===i&&(Ft.test(e.charAt(oe))?(t=e.charAt(oe),oe++):(t=i,0===de&&ve(kt))))))))))))))),t}function Je(){let t,r;for(de++,t=[],Jt.test(e.charAt(oe))?(r=e.charAt(oe),oe++):(r=i,0===de&&ve(Vt)),r===i&&(r=Ve());r!==i;)t.push(r),Jt.test(e.charAt(oe))?(r=e.charAt(oe),oe++):(r=i,0===de&&ve(Vt)),r===i&&(r=Ve());return de--,t===i&&(r=i,0===de&&ve(_t)),t}function Ve(){let t,r,n,s,a,u,o;if(de++,t=oe,"/*"===e.substr(oe,2)?(r="/*",oe+=2):(r=i,0===de&&ve(Ut)),r!==i){for(n=[],Mt.test(e.charAt(oe))?(s=e.charAt(oe),oe++):(s=i,0===de&&ve(zt)),s===i&&(s=oe,42===e.charCodeAt(oe)?(a="*",oe++):(a=i,0===de&&ve(Lt)),a!==i?(u=oe,de++,Pt.test(e.charAt(oe))?(o=e.charAt(oe),oe++):(o=i,0===de&&ve(qt)),de--,o===i?u=void 0:(oe=u,u=i),u!==i?(a=[a,u],s=a):(oe=s,s=i)):(oe=s,s=i));s!==i;)n.push(s),Mt.test(e.charAt(oe))?(s=e.charAt(oe),oe++):(s=i,0===de&&ve(zt)),s===i&&(s=oe,42===e.charCodeAt(oe)?(a="*",oe++):(a=i,0===de&&ve(Lt)),a!==i?(u=oe,de++,Pt.test(e.charAt(oe))?(o=e.charAt(oe),oe++):(o=i,0===de&&ve(qt)),de--,o===i?u=void 0:(oe=u,u=i),u!==i?(a=[a,u],s=a):(oe=s,s=i)):(oe=s,s=i));n!==i?("*/"===e.substr(oe,2)?(s="*/",oe+=2):(s=i,0===de&&ve(Bt)),s!==i?(r=[r,n,s],t=r):(oe=t,t=i)):(oe=t,t=i)}else oe=t,t=i;if(t===i)if(t=oe,"//"===e.substr(oe,2)?(r="//",oe+=2):(r=i,0===de&&ve(Ht)),r!==i){for(n=[],Gt.test(e.charAt(oe))?(s=e.charAt(oe),oe++):(s=i,0===de&&ve(Kt));s!==i;)n.push(s),Gt.test(e.charAt(oe))?(s=e.charAt(oe),oe++):(s=i,0===de&&ve(Kt));n!==i?(Tt.test(e.charAt(oe))?(s=e.charAt(oe),oe++):(s=i,0===de&&ve(jt)),s===i&&(s=null),s!==i?(r=[r,n,s],t=r):(oe=t,t=i)):(oe=t,t=i)}else oe=t,t=i;return de--,t===i&&(r=i,0===de&&ve(Dt)),t}function De(){let t,r;return de++,Wt.test(e.charAt(oe))?(t=e.charAt(oe),oe++):(t=i,0===de&&ve(Xt)),de--,t===i&&(r=i,0===de&&ve(Qt)),t}function Ue(){let t;return Yt.test(e.charAt(oe))?(t=e.charAt(oe),oe++):(t=i,0===de&&ve(Zt)),t}function Me(){let t,r,n,s;return t=oe,r=Je(),r!==i?(44===e.charCodeAt(oe)?(n=",",oe++):(n=i,0===de&&ve(te)),n!==i?(s=Je(),s!==i?(r=[r,n,s],t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i),t}function ze(){let t,r,n,s;return t=oe,r=Je(),r!==i?(58===e.charCodeAt(oe)?(n=":",oe++):(n=i,0===de&&ve(ee)),n!==i?(s=Je(),s!==i?(r=[r,n,s],t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i),t}function Le(){let t,r,n,s;return t=oe,r=Je(),r!==i?(91===e.charCodeAt(oe)?(n="[",oe++):(n=i,0===de&&ve(re)),n!==i?(s=Je(),s!==i?(r=[r,n,s],t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i),t}function Pe(){let t,r,n,s;return t=oe,r=Je(),r!==i?(93===e.charCodeAt(oe)?(n="]",oe++):(n=i,0===de&&ve(ne)),n!==i?(s=Je(),s!==i?(r=[r,n,s],t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i),t}function qe(){let t,r,n,s;return t=oe,r=Je(),r!==i?(123===e.charCodeAt(oe)?(n="{",oe++):(n=i,0===de&&ve(ie)),n!==i?(s=Je(),s!==i?(r=[r,n,s],t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i),t}function Be(){let t,r,n,s;return t=oe,r=Je(),r!==i?(125===e.charCodeAt(oe)?(n="}",oe++):(n=i,0===de&&ve(se)),n!==i?(s=Je(),s!==i?(r=[r,n,s],t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i),t}function He(){let t,r,n,s;return t=oe,r=Je(),r!==i?(40===e.charCodeAt(oe)?(n="(",oe++):(n=i,0===de&&ve(ae)),n!==i?(s=Je(),s!==i?(r=[r,n,s],t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i),t}function Ge(){let t,r,n,s;return t=oe,r=Je(),r!==i?(41===e.charCodeAt(oe)?(n=")",oe++):(n=i,0===de&&ve(ue)),n!==i?(s=Je(),s!==i?(r=[r,n,s],t=r):(oe=t,t=i)):(oe=t,t=i)):(oe=t,t=i),t}function Ke({ty:t,fn:e=null,ls:r=null}){const n={ty:t};return null!==e&&(n.fn=e),null!==r&&(n.ls=r),n}if(n=a(),n!==i&&oe===e.length)return n;throw n!==i&&oe<e.length&&ve({type:"end"}),Ae(he,fe<e.length?e.charAt(fe):null,fe<e.length?be(fe,fe+1):be(fe,fe))}}}();export const Types=new class{#t={"@arr@":{name:"array"},"@obj@":{name:"object"},"@or@":{name:"multi-type"},any:{parse:function(t){return t}},null:{parse:function(t){if(null===t)return null;const{valid:e,value:r}=Types.parse("string",t);return e&&(""===r||"null"===r.toLowerCase())?null:void 0}},num:{parse:function(t){return Types.parse("float",t)}},float:{parse:function(t){switch(typeof t){case"number":return Number.isNaN(t)?Ret.Invalid():t;case"boolean":return t?1:0;case"object":t=String(t);case"string":return t=Number(t),Number.isNaN(t)?Ret.Invalid():t;case"function":case"symbol":case"undefined":default:return}}},int:{parse:function(t){const{valid:e,value:r}=Types.parse("float",t);if(e&&Number.isInteger(r))return r}},unsigned:{parse:function(t){const{valid:e,value:r}=Types.parse("float",t);if(e&&Number.isInteger(r)&&r>=0)return r}},bool:{parse:function(t){switch(typeof t){case"boolean":return t;default:return Boolean(t)}}},string:{parse:function(t){switch(typeof t){case"string":return t;case"object":return null===t?"null":JSON.stringify(t);case"bigint":case"number":case"boolean":return new String(t).valueOf();case"undefined":return Ret.Valid("");case"function":case"symbol":default:return}}},hex:{name:"hex-string",parse:function(t){const{valid:e,value:r}=Types.parse("string",t);if(e&&/^[0-9a-f]+$/i.test(r))return Number(r)}},email:{name:"email-string",parse:function(t){const{valid:e,value:r}=Types.parse("string",t);if(e){const t=document?.createElement("input");if(null!==t){if(t.type="email",t.value=r,t.checkValidity())return r}else if(/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(r))return r}}},base64:{name:"base64-string",parse:function(t){const{valid:e,value:r}=Types.parse("string",t);if(e)try{return atob(r.replace(/-/g,"+").replace(/_/g,"/"))}catch(t){}}},json:{name:"json-string",parse:function(t){switch(typeof t){case"bigint":case"boolean":case"number":case"object":return t;case"string":try{return JSON.parse(t)}catch(t){}break;case"symbol":case"undefined":case"function":default:return}}},timestamp:{name:"timestamp-string",parse:function(t){const{valid:e,value:r}=Types.parse("string",t);if(e&&(val=new Date(r).valueOf(),NaN===val&&(val=Date.parse(r)),NaN!==val))return val}}};add({type:t,name:e=null,handler:r}){if("string"!=typeof t)throw new TypeError("Type must be a string");if(null!==e&&"string"!=typeof e)throw new TypeError("Name must be a string");if("function"!=typeof r)throw new TypeError("Handler must be a funciton");this.#t[t]={parse:r},null!==e&&(this.#t[t].name=e)}name(t){return void 0===this.#t[t]?null:this.#t[t].name??t}parse(t,e){if(void 0===this.#t[t])return Ret.Invalid(`Unknown type: ${JSON.stringify(t)}`);const r=this.#t[t].parse(e);return void 0===r?Ret.Invalid(`Expected type: '${this.name(t)}'; Received: ${JSON.stringify(e)}`):r instanceof Ret?(r.valid||(r.error??=`Expected type: '${this.name(t)}'; Received: ${JSON.stringify(e)}`),r):Ret.Valid(r)}};export const Funcs=new class{#e=[{name:"_toString",ty:["any"],fn:function(t){const{valid:e,value:r}=Types.parse("string",t);if(e)return r}},{name:"_allowed",ty:["any"],fn:function(t,...e){return e.includes(t)?t:Ret.Invalid(`Disallowed value: ${JSON.stringify(t)}`)}},{name:"_at",ty:["@arr@"],fn:function(t,...e){for(p of e)if("number"!=typeof p)throw new RangeError(`Only numeric arguments allowed; Args=${JSON.stringify(e)}`);const r=e.map((e=>t.at(e)));return 1===r.length?r[0]:r}},{name:"_slice",ty:["@obj@","any"],fn:function(t,...e){const r=[];for(const n of e)Object.hasOwn(t,n)&&r.push([n,t[n]]);switch(e.length){case 0:return null;case 1:return 0===r.length?null:r[0][1];default:return Object.fromEntries(r)}}},{name:"_title",ty:["string"],fn:function(t){return t.replace(/\w\S*/g,(t=>`${t.charAt(0).toUpperCase()}${t.substring(1).toLowerCase()}`))}},{name:"_isUUID4",ty:["string"],fn:function(t){if(/^[0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i.test(t))return t.toLowerCase();throw new TypeError("Not a UUID4 string")}},{name:"_range",ty:["float","num","int","unsigned"],fn:function(t,e=null,r=null){if(null!==e&&"number"!=typeof e)throw new TypeError("Only null or number allowed as arguments");if(null!==r&&"number"!=typeof r)throw new TypeError("Only null or number allowed as arguments");return null!==e&&t<e||null!==r&&t>r?Ret.Invalid(`Expected range [${e??"null"}, ${r??"null"}]`):t}},{name:"_add",ty:["float","num","int","unsigned"],fn:function(t,e=0){if("number"==typeof e)return t+e;throw new TypeError("Only numeric argument allowed")}},{name:"_sub",ty:["float","num","int","unsigned"],fn:function(t,e=0){if("number"==typeof e)return t-e;throw new TypeError("Only numeric argument allowed")}},{name:"_mul",ty:["float","num","int","unsigned"],fn:function(t,e=1){if("number"==typeof e)return t*e;throw new TypeError("Only numeric argument allowed")}},{name:"_div",ty:["float","num","int","unsigned"],fn:function(t,e=1){if("number"==typeof e&&0!==e)return t/e;throw new TypeError("Only non-zero numeric argument allowed")}},{name:"_mod",ty:["float","num","int","unsigned"],fn:function(t,e){if("number"==typeof e&&0!==e)return t%e;throw new TypeError("Only non-zero numeric argument allowed")}},{name:"_exp",ty:["float","num","int","unsigned"],fn:function(t,e=1){if("number"==typeof e)return t**e;throw new TypeError("Only numeric argument allowed")}},{name:"_round",ty:["float","num","int","unsigned"],fn:function(t,e=2){if("number"==typeof e)return Number(t.toFixed(e));throw new TypeError("Only numeric argument allowed")}}];#r=[];constructor(){this.reInit()}add(t,e,...r){if("function"!=typeof t)throw new TypeError("Invalid handler");if("string"!=typeof e)throw new TypeError("Invalid name");for(const t of r)if(null===Types.name(t))throw new TypeError(`Invalid type: ${JSON.stringify(t)}`);"_"!==e.at()&&(e=`_${e}`),this.#e.push({name:e,ty:r,fn:t}),this.reInit()}reInit(){this.#r=this.#e.map((({name:t,ty:e})=>e.map((e=>`${e}.${t}`)))).flat(1)}exists(t,e){return this.#r.includes(`${t}.${e}`)?1:!!this.#r.includes(`any.${e}`)&&2}getFn(t,e){let r;switch(this.exists(t,e)){case!1:return null;case 1:r=t;break;case 2:r="any";break}for(const t of this.#e)if(t.name===e&&t.ty.includes(r))return t.fn;return null}runFn(t,e,r,n){if("_"===e.at()){const i=this.getFn(t,e);if("function"!=typeof i)return Ret.Invalid(`Function missing: "${t}.${e}";`);try{const s=i(r,...n);return void 0===s?Ret.Invalid(`Function ${t}.${e} Error; Failed; Received: ${JSON.stringify(r)}`):s instanceof Ret?(s.valid||(s.error=`Function ${t}.${e} Error; ${s.error??""}; Received: ${JSON.stringify(r)}`),s):Ret.Valid(s)}catch(n){return Ret.Invalid(`Function ${t}.${e} Error; ${n.message}; Received: ${JSON.stringify(r)}`)}}else{if("function"!=typeof r[e])return Ret.Invalid(`There is no native function '${e}' for type '${Object.prototype.toString.call(r)}'`);try{const t=r[e](...n);return Ret.Valid(t)}catch(n){return Ret.Invalid(`Function ${t}.${e} Error; ${n.message}; Received: ${JSON.stringify(r)}`)}}}};export class DataValidator{static New(t,...e){function r(t){switch(typeof t){case"object":return JSON.stringify(t);case"function":return r(t());default:return String(t)}}let n=[];for(let i=0,s=t.length-1;i<s;i++)n.push(t[i]),n.push(r(e[i]));n.push(t[t.length-1]),n=n.join("");try{const t=new DataValidator(Parser.parse(n));return t.__structureSyntax__=n,t}catch(t){throw t instanceof Parser.SyntaxError?new Error(`Parse Error; Line:${t.location.start.line}; Column:${t.location.start.column}; ${t.message}`):new Error(t.message)}}static#n(t){t.idx=-1,t.len=t.length-1,t.rpt=0,t.next=function(t=!1){return 0===this.rpt?(this.idx++,this.rpt="reset",this.idx>this.len?"error":this.next()):"reset"===this.rpt?(this.rpt=this[this.idx].rpt??1,this.next(t)):"yes"===this.rpt?t?this.idx===this.len?"error":(this.rpt=0,this.next(t)):this[this.idx]:(this.rpt--,this[this.idx])}}static#i(t,e=0){if(!isObject(t))return Ret.Invalid("Not an object");const{ty:r=null,fn:n=[],nx:i=null}=t;if("string"!=typeof r||null===Types.name(r))return Ret.Invalid(`Unknown type: ${JSON.stringify(r)}`);{let n=null;switch(r){case"@obj@":n=t=>`{${t}}`;break;case"@arr@":n=t=>`[${t}]`;break;case"@or@":n=t=>"(multi-type)";break;default:break}if(null!==n){const r=t.ls??[];for(const[t,i]of Object.entries(r)){const r=DataValidator.#i(i,e+1);if(!r.valid)return r.error=`${n(t)}: ${r.error}`,r}}}for(const t of n)if("_"===t.fn.at()&&!Funcs.exists(r,t.fn))return Ret.Invalid(`Unknown Function: '${r}.${t.fn}'`);if(null!==i){const t=DataValidator.#i(i,e+1);if(!t.valid)return t.error=`${Types.name(r)}\n=> ${t.error}`,t}return Ret.Valid()}#s;constructor(t,e=!0){if(e){const e=DataValidator.#i(t);if(null!==e.error)throw new Error(`StructError: ${e.error}`)}this.#s=t}get struct(){return this.#s}validate(t){return DataValidator.#a(t,this.#s)}static#a(t,e,r=0){const{ty:n=null,fn:i=[],nx:s=null}=e;switch(n){case"@arr@":{if(!Array.isArray(t))return Ret.Invalid(`Expected array; Received ${JSON.stringify(t)};`);const n=[],i=e.ls??[];DataValidator.#n(i);let s=i.next();const a=Object.entries(t);for(let t=0,e=a.length;t<e;t++){const[e,u]=a[t];if("error"===s)return Ret.Invalid(`[${e}] Index out of bounds`);let o=DataValidator.#a(u,s,r+1);if(!o.valid){if("many"===i.more&&i.idx!==i.len){s=i.next(!0),t--;continue}return Ret.Invalid(`[${e}]: ${o.error}`)}n.push(o.value),s=i.next()}t=n}break;case"@obj@":{if(!isObject(t))return Ret.Invalid(`Expected object; Received ${JSON.stringify(t)};`);const n=e.ls??{};for(const[e,{def:r}]of Object.entries(n))void 0!==r&&void 0===t[e]&&(t[e]=r);const i=Object.keys(n);{const e=i.filter((t=>n[t].rq??!1)),r=Object.keys(t),s=[];for(const t of e)r.includes(t)||s.push(`{${t}}`);if(0!==s.length)return Ret.Invalid(`Missing object key(s): ${s.join(", ")}; Received ${JSON.stringify(t)};`)}const s=e.kp??!1,a={};for(const[e,u]of Object.entries(t))if(i.includes(e)){const t=DataValidator.#a(u,n[e],r+1);if(!t.valid)return Ret.Invalid(`{${e}}: ${t.error}`);a[e]=t.value}else s&&(a[e]=u);t=a}break;case"@or@":{const n=e.ls??[];let i=null;for(const e of n)if(i=DataValidator.#a(t,e,r+1),i.valid)break;if(null===i||!i.valid)return Ret.Invalid(`Expected type(s): (${n.map((t=>t.ty??"undefined")).join("|")}); Received: ${JSON.stringify(t)};`);t=i.value}break;default:{const e=Types.parse(n,t);if(!e.valid)return Ret.Invalid(`Expected type: ${Types.name(n)}; Received: ${JSON.stringify(t)};`);t=e.value}break}for(const e of i){let{fn:r="undefined",args:i=[]}=e;const s=Funcs.runFn(n,r,t,i);if(!s.valid)return s.error??=`Cannot convert ${JSON.stringify(t)};`,Ret.Invalid(`Formatter '${Types.name(n)}.${r}' error: ${s.error}`);t=s.value}if(null!==s){const e=DataValidator.#a(t,s,r+1);if(!e.valid)return e.error=`${Types.name(n)}\n=> ${e.error}`,e;t=e.value}return Ret.Valid(t)}}